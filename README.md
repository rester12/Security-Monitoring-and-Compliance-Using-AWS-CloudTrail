# Security-Monitoring-and-Compliance-Using-AWS-CloudTrail

I created an AWS Lambda function and configured an event notification for Amazon Simple Storage Service (Amazon S3).
 
<h2>Description</h2> 

I created an AWS Lambda function that resizes an uploaded image to create a thumbnail. I then configured an event notification in Amazon S3 to trigger the Lambda function whenever an image is uploaded. The function processes the original image, resizes it into a thumbnail, and saves it in a target S3 bucket. Finally, I monitored the Lambda function's performance and logged events using Amazon CloudWatch.<br /> 
<h2>Languages and Utilities Used</h2> 

- <b> Amazon S3: </b> Amazon S3 is an object storage service that offers industry-leading scalability, data availability, security, and performance. It stores and protect any amount of data for a range of use cases, such as data lakes, websites, built-for-the-cloud applications, backups, archives, machine learning, and analytics.<br />

- <b> IAM: </b> AWS Identity and Access Management (IAM) is a web service that helps you securely control access to AWS resources. With IAM, you can centrally manage permissions that control which AWS resources users can access. You use IAM to control who is authenticated (signed in) and authorized (has permissions) to use resources.<br />

- <b> AWS Lambda: </b> AWS Lambda is a compute service that lets you run code without provisioning or managing servers. Lambda runs your code on a high availability compute infrastructure and performs the administration of the compute resources, including server and operating system maintenance, capacity provisioning and automatic scaling, and logging. With Lambda, all you need to do is supply your code in one of the language runtimes that Lambda supports.<br />

- <b> AWS CloudWatch: </b> AWS CloudWatch is a monitoring and observability service provided by AWS that allows you to monitor your AWS resources and the applications you run on AWS in real time. It collects and tracks metrics, which are variables you can measure for your resources and applications, providing system-wide visibility into resource utilization, application performance, and operational health. 
<h2>Environments Used </h2>
<b>Cloud Platform:

  AWS (Amazon Web Services): This project was conducted entirely in AWS, utilizing several of its services. 
</b> 
<h2>Program walk-through:</h2> 
<p align="center"> 

The following diagram depicts the basic architecture of application flow.
<br/>
 
![Figure 1](https://i.imgur.com/uBiG1UT.png)
<i>Figure 1: The diagram illustrates a user uploading an object to the source bucket in Amazon S3 (object-created event). Amazon S3 detects the object-created event and publishes the event to AWS Lambda by invoking the Lambda function and passing event data as a function parameter. AWS Lambda runs the Lambda function. From the event data it receives, the Lambda function knows the source bucket name and object key name. The Lambda function reads the object and creates a thumbnail using graphics libraries, then saves the thumbnail to the target bucket..</i>
<br />
<br />
<br />
 
In this project, I set up image storage and processing by creating two Amazon S3 (Simple Storage Service) buckets:
 
A source bucket to store the original image.

A target bucket to store the resized thumbnail image generated by an AWS Lambda function.
 
To create the buckets, I accessed the AWS Management Console, searched for S3, and selected it. Then, I clicked Create bucket to begin the setup.
 
The first bucket, the source bucket, was created to store the original uploaded images. The second bucket, the target bucket, was designed to store resized thumbnail images after processing by the Lambda function.
 
Since S3 bucket names must be globally unique, I followed proper naming conventions. The generic names images and images-resized were unavailable, so I appended a unique identifier to ensure uniqueness:
 
Source bucket: resterimages-123456.
 
Target bucket: resterimages-resized123456.
 
This setup ensures seamless image processing and storage within AWS.
 
<br/>
 
![S3 Buckets](https://i.imgur.com/RdlJDJs.png)
 
The next step involved uploading an image for testing using the Amazon S3 Console to add a file to the source bucket.
 
I selected HappyFace.jpg and saved it to my computer, then, I accessed the Amazon S3 Console, opened the source bucket (resterimages-123456789), and clicked Upload.
 
In the Upload window, I clicked Add files, selected HappyFace.jpg, and initiated the upload.  Once the upload was complete, an "Upload succeeded" message appeared at the top of the page, confirming that the file was successfully uploaded.
 
<br/>
 
 
![S3 Buckets](https://i.imgur.com/S1S2ftp.png)
 
Creating an IAM Role for the Lambda Function

To enable the Lambda function, an IAM role was created and configured with permissions to read and write images in the S3 source and target buckets.
 
Steps to Create the IAM Role:
 
Open the AWS Management Console, search for IAM, and select it.
 
In the IAM Dashboard, go to the Roles section and click Create role.
 
Under Trusted entity type, select AWS service.
 
For Use case, choose Lambda, then click Next.
 
In the Permissions policies section, attach the appropriate policy:
 
Search for and select AmazonS3FullAccess to allow read and write access to S3 buckets.
 
Click Next, provide a Role name (e.g., lambda-execution-role), and add an optional description.

Click Create role to complete the setup.
 
 
When creating an IAM role, it's essential to attach the appropriate permissions. I always follow the <b> principle of least privilege, </b> granting only the permissions necessary to perform specific tasks. You can either use AWS-managed policies or create custom policies tailored to your needs.
 
![S3 Buckets](https://i.imgur.com/BB4p85J.png)
 
<br/>
 
To automate image processing, a Lambda function is configured with an Amazon S3 trigger, enabling it to execute whenever a new object is uploaded to the source S3 bucket.
 
I created the Lambda Function by:
 
<ol>
<li><b>Open the AWS Management Console</b></li>
<li><b>Search for Lambda and select it</b></li>
<li><b>Click create function</b></li>                 
<li><b>Select Author from scratch</b></b></li>
<li><b>In the Basic information section, configure the following:</b><br /> Function name: Create-Thumbnail <br /> Runtime: Select Python 3.9 from the available options.<br /> Expand Change default execution role and choose: Execution role: <br />Use an existing role Existing role: lambda-execution-role (Grants permission to read and write images in S3 buckets.</li>
<li><b>Click create function</b></li></li>
</ol>
 
Once the function is successfully created, a "Successfully created the function" message appears at the top of the page.
 
<br/>
 
![S3 Buckets](https://i.imgur.com/y4msl5c.png)
 
<br/>
 
![S3 Buckets](https://i.imgur.com/ho14x4N.png)
 
<br/>
 
I set up an Amazon S3 trigger to automatically invoke the Lambda function whenever an image is uploaded to the source S3 bucket. The Lambda function then processes the image. This kind of automation is essential in cloud computing for efficient workflows.
 
Steps to create the S3 trigger:
 
<ol>
<li><b>Go to the Create-Thumbnail Lambda function page</b></li>
<li><b>In the Function overview section, click Add trigger</b></li>
<li><b>Click create function</b></li>                 
<li><b>In the Trigger configuration section, configure the following settings:</b><br /> Source: Select S3 <br />Bucket: Choose the source bucket. ex resterimages-123456789 <br /> Acknowledge the Recursive invocation warning </li>
<li><b>Click Add</b></li></li>
</ol>
<br />

Once the trigger is successfully added, a "Trigger was successfully added to function" message appears at the top of the page.
 
<br />
<br />
 
![S3 Buckets](https://i.imgur.com/c2JJ4ic.png)
 
![S3 Buckets](https://i.imgur.com/QmYaHYq.png)
 
![S3 Buckets](https://i.imgur.com/7U9H2pf.png)
 
 
To enable image processing, I configured the Lambda function by uploading the <strong> CreateThumbnail.zip.zst </strong> deployment package in the Code tab of the Lambda console. Please refer to the <strong> CreateThumbnail.zip.zst </strong> file attached to this repository.
 
The function performs several tasks: receiving an event with the image name, downloading the image, resizing it using the Pillow library, and uploading the resized image to the target S3 bucket.
<br />
<br />
 
Next, I set the Handler to CreateThumbnail.handler under Runtime settings and updated the General Configuration by adding a description and keeping default memory and timeout settings.
 
To test the function, I created a test event in the Lambda console using the S3 Put template, replacing example-bucket with my source bucket name resterimages-123456789.
 
Running the test successfully processed the HappyFace.jpg image, confirmed by the "Execution succeeded" message.
 
<br />
 
![Test Lambda](https://i.imgur.com/7yRgUEe.png)
 
Finally, I verified the output by checking the target S3 bucket (resterimages-123456-resized), where the resized image appeared as expected.
 
Additionally, I monitored the Lambda function through the Monitor tab in the console, reviewing key metrics such as invocations, duration, and errors, as well as analyzing detailed logs in Amazon CloudWatch.
 
I encountered an issue where the function was not completing successfully. According to the CloudWatch logs, the target bucket did not exist. Upon troubleshooting, I discovered that the bucket was incorrectly named. After reviewing the steps, I renamed the bucket to match the required naming scheme, which resolved the issue.
 
<b>Lesson learned:</b> Adhering strictly to naming schemes is essential to prevent errors.
 
<br />
 
![Verified Output](https://i.imgur.com/fmuX1Lj.png)
 
<br />
 
To mark the successful completion of the project, Rester and I took a commemorative photo together.
 
![Verified Output](https://i.imgur.com/HEpG7ml.jpeg)

 
